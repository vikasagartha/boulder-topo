<!DOCTYPE html>
<html lang="en">

<head>
  <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  <meta charset="utf-8">
  <title>Vikas' Boulder</title>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
  <style type="text/css">
    body {
      margin: 0;
      background-color: whitesmoke;
      font-family: 'Times New Roman', sans-serif;
      font-weight: 300;
    }

    #svgcontainer {
      width: 1000px;
      margin-left: auto;
      margin-right: auto;
      margin-top: 50px;
      padding: 5px 50px 10px 50px;
      background-color: whitesmoke;
    }

    svg {
      background-color: whitesmoke;
    }
  </style>
</head>

<body>
  <div id="svgcontainer">
    <div id="svganchor"></div>
    <br>
  </div>
  <script type="text/javascript">

        //Width and height
    let w = 1000;
    let h = 800;

        //Define map projection
    let projection = d3.geo.albersUsa()
    //.translate([w / 2, h / 2])
    .scale([1000]);

        //Define path generator
    let path = d3.geo.path()
    .projection(projection);

        //Create SVG
    let svg = d3.select("#svganchor")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

    const drawMap = json => {

            //Bind data and create one path per GeoJSON feature
        svg.selectAll("path")
        .data(json.features)
        .enter()
        .append("path")
        .attr("d", path)
        .attr("stroke", "dimgray")
        .style("opacity", 1)
        .attr("fill", 'beige')

      }

    const drawCircles = data => {

            // Create a color scale
        let color = d3.scale.category20();

                let tooltip = d3.select("body")
                .append("div")
                .style("position", "absolute")
                .style("text-align", "center")
                .style("padding", "15px")
                .style("font", "12px sans-serif")
                .style("background", "#03bafc")
                .style("border", "0px")
                .style("border-radius", "8px")
                .style("z-index", "10")
                .style("visibility", "hidden")
                .text("a simple tooltip");

                svg
                .selectAll("myCircles")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", (d) => { return projection([+d.lon, +d.lat])[0] })
                .attr("cy", (d) => { return projection([+d.lon, +d.lat])[1] })
                .attr("r", (d) => { return 5})
                .style("fill", (d) => { return 'blue'})
                .attr("stroke-width", 1)
                .attr("fill-opacity", 0.6)
                .on("mouseover", () => {
                  return tooltip.style("visibility", "visible");
                })
                .on("mousemove", (d) => {
                  tooltip.text(`${d.currentTarget.__data__.name} v${d.currentTarget.__data__.grade}`);
                  return tooltip.style("top",
                    (d.pageY - 10) + "px").style("left", (d.pageX + 10) + "px");
                })
                .on("mouseout", function(){return tooltip.style("visibility", "hidden");});

              }


    async function main(param0) {
      const jsonData = await d3.json("usa.json")
      drawMap(jsonData)
      const csvData = await d3.csv("boulders.csv")
      drawCircles(csvData)
    }

    main()


  </script>
</body>

</html>
